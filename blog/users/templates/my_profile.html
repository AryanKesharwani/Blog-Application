{% extends "base.html" %}
{% block title %}My Profile{% endblock %}
{% load static %}

{% block content %}
<style>
  /* Profile Card Styling */
  .profile-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: none;
    transition: all 0.3s ease;
  }
  .profile-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
  }
  .profile-avatar {
    width: 130px;
    height: 130px;
    object-fit: cover;
    border: 4px solid #fff;
    transition: transform 0.3s ease;
  }
  .profile-avatar:hover {
    transform: scale(1.05);
  }
  /* Stats */
  .profile-stats {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
  }
  .profile-stat {
    text-align: center;
  }
  .profile-stat h5 {
    margin: 0;
    font-weight: bold;
  }
  .profile-stat span {
    font-size: 0.85rem;
    color: #6c757d;
  }
  /* Post Card Hover */
  .post-card {
    transition: all 0.3s ease;
  }
  .post-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
  }
</style>

<div class="container py-5">

  <!-- Profile Card -->
  <div class="card p-4 shadow-sm rounded-4 mb-5 profile-card">
    <div class="d-flex flex-wrap align-items-center gap-4">

      <!-- Profile Image -->
      <img src="{% if profile_user.profile_image %}{{ profile_user.profile_image.url }}{% else %}{% static 'default-avatar.png' %}{% endif %}" 
           class="rounded-circle shadow profile-avatar object-fit-contain" alt="Profile Image">

      <!-- User Info -->
      <div>
        <h3 class="mb-1 fw-bold">{{ profile_user.name|default:profile_user.username }}</h3>
        <p class="text-muted mb-2"><i class="bi bi-envelope me-1"></i>{{ profile_user.email }}</p>
        <p class="text-muted small mb-3">Joined on {{ profile_user.date_joined|date:"F j, Y" }}</p>

        <!-- Stats -->
        <div class="profile-stats">
          <div class="profile-stat">
            <h5>{{ posts.count }}</h5>
            <span>Posts</span>
          </div>
          <div class="profile-stat">
            <h5>{{ total_likes|default:"0" }}</h5>
            <span>Likes</span>
          </div>
          <div class="profile-stat">
            <h5>{{ total_comments|default:"0" }}</h5>
            <span>Comments</span>
          </div>
        </div>
      </div>

      <!-- Edit Button -->
      <a href="{% url 'profile_edit' profile_user.username %}" 
         class="btn btn-outline-primary rounded-pill ms-auto">
        <i class="bi bi-pencil-square me-1"></i> Edit Profile
      </a>

    </div>
  </div>

  <!-- My Posts -->
  <h4 class="fw-semibold mb-3">My Posts</h4>
  {% if posts %}
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for post in posts %}
    <div class="col">
      <div class="card h-100 shadow-sm border-0 rounded-4 post-card">
        {% if post.image %}
        <img src="{{ post.image.url }}" class="card-img-top rounded-top-4" 
             style="height: 200px; object-fit: cover;" alt="{{ post.title }}">
        {% else %}
        <img src="{% static 'default.jpg' %}" class="card-img-top rounded-top-4" 
             style="height: 200px; object-fit: cover;" alt="No Image">
        {% endif %}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title fw-semibold">{{ post.title }}</h5>
          <p class="card-text text-muted small mb-3">
            <i class="bi bi-calendar-event me-1"></i>{{ post.created_at|date:"M d, Y" }}
          </p>
          <a href="{% url 'post_detail' post.pk %}" 
             class="btn btn-outline-dark rounded-pill mt-auto">Read More</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="text-muted">You haven't published any posts yet.</div>
  {% endif %}

</div>
{% endblock %}
